<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birlikteyiz Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        .logo span {
            margin-left: 10px;
        }

        .status-indicators {
            display: flex;
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .status-online { color: #4CAF50; }
        .status-offline { color: #f44336; }
        .status-warning { color: #ff9800; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .emergency-panel {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .emergency-panel .card-title {
            color: white;
        }

        .sos-button {
            background: #fff;
            color: #ff6b6b;
            border: none;
            padding: 20px;
            border-radius: 50%;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 80px;
            height: 80px;
            margin: 20px auto;
            display: block;
            font-weight: bold;
        }

        .sos-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .device-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .device-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .device-item:last-child {
            border-bottom: none;
        }

        .device-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .device-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
        }

        .device-status.offline {
            background: #f44336;
        }

        .message-list {
            max-height: 250px;
            overflow-y: auto;
        }

        .message-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .message-item.emergency {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: #666;
        }

        .message-content {
            color: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .ai-panel {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .ai-panel .card-title {
            color: white;
        }

        .ai-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .ai-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .ai-feature {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .ai-feature:hover {
            background: rgba(255,255,255,0.2);
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 2em;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .network-map {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .status-indicators {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                üêô <span>Birlikteyiz</span>
            </div>
            <div class="status-indicators">
                <div class="status-item">
                    <span class="status-online">‚óè</span>
                    <span>LoRa Aktif</span>
                </div>
                <div class="status-item">
                    <span class="status-online">‚óè</span>
                    <span>WiFi Baƒülƒ±</span>
                </div>
                <div class="status-item">
                    <span class="status-warning">‚óè</span>
                    <span>AI Sƒ±nƒ±rlƒ±</span>
                </div>
                <div class="status-item">
                    <span id="device-name">octopus</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="dashboard-grid">
            <!-- Emergency Panel -->
            <div class="card emergency-panel">
                <div class="card-header">
                    <span class="card-icon">üö®</span>
                    <span class="card-title">Acil Durum</span>
                </div>
                <button class="sos-button" onclick="sendSOS()">SOS</button>
                <p style="text-align: center; margin-top: 10px;">
                    Acil durumda SOS butonuna basƒ±n
                </p>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="openMessageModal()" style="width: 100%; background: rgba(255,255,255,0.2);">
                        Acil Mesaj G√∂nder
                    </button>
                </div>
            </div>

            <!-- Network Status -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üåê</span>
                    <span class="card-title">Aƒü Durumu</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="online-devices">3</div>
                        <div class="stat-label">√áevrimi√ßi Cihaz</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="signal-strength">-45</div>
                        <div class="stat-label">Sinyal (dBm)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="messages-today">12</div>
                        <div class="stat-label">Bug√ºnk√º Mesaj</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="network-range">8.5</div>
                        <div class="stat-label">Menzil (km)</div>
                    </div>
                </div>
            </div>

            <!-- Connected Devices -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üì±</span>
                    <span class="card-title">Baƒülƒ± Cihazlar</span>
                </div>
                <div class="device-list" id="device-list">
                    <div class="device-item">
                        <div class="device-info">
                            <div class="device-status"></div>
                            <div>
                                <strong>dolphin</strong><br>
                                <small>Pi Zero 2W ‚Ä¢ 2.3km</small>
                            </div>
                        </div>
                        <div>-52 dBm</div>
                    </div>
                    <div class="device-item">
                        <div class="device-info">
                            <div class="device-status"></div>
                            <div>
                                <strong>eagle</strong><br>
                                <small>Pi 5 ‚Ä¢ 5.1km</small>
                            </div>
                        </div>
                        <div>-68 dBm</div>
                    </div>
                    <div class="device-item">
                        <div class="device-info">
                            <div class="device-status offline"></div>
                            <div>
                                <strong>mountain</strong><br>
                                <small>Pi Zero 2W ‚Ä¢ Son: 2 saat √∂nce</small>
                            </div>
                        </div>
                        <div>√áevrimdƒ±≈üƒ±</div>
                    </div>
                </div>
            </div>

            <!-- Recent Messages -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üí¨</span>
                    <span class="card-title">Son Mesajlar</span>
                </div>
                <div class="message-list" id="message-list">
                    <div class="message-item emergency">
                        <div class="message-header">
                            <strong>eagle</strong>
                            <span>5 dakika √∂nce</span>
                        </div>
                        <div class="message-content">
                            üö® SOS - Yardƒ±ma ihtiyacƒ±m var! Konum: 37.0431¬∞N, 27.3033¬∞E
                        </div>
                    </div>
                    <div class="message-item">
                        <div class="message-header">
                            <strong>dolphin</strong>
                            <span>15 dakika √∂nce</span>
                        </div>
                        <div class="message-content">
                            Sistem testi - Her ≈üey normal √ßalƒ±≈üƒ±yor
                        </div>
                    </div>
                    <div class="message-item">
                        <div class="message-header">
                            <strong>Sistem</strong>
                            <span>1 saat √∂nce</span>
                        </div>
                        <div class="message-content">
                            Yeni cihaz aƒüa katƒ±ldƒ±: mountain
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Assistant -->
            <div class="card ai-panel">
                <div class="card-header">
                    <span class="card-icon">ü§ñ</span>
                    <span class="card-title">AI Asistan</span>
                </div>
                <div class="ai-status">
                    <span class="status-warning">‚óè</span>
                    <span>Sƒ±nƒ±rlƒ± Mod (ƒ∞nternet Yok)</span>
                </div>
                <div class="ai-features">
                    <div class="ai-feature" onclick="aiTranslate()">
                        üåç<br>√áeviri
                    </div>
                    <div class="ai-feature" onclick="aiAnalyze()">
                        üìä<br>Analiz
                    </div>
                    <div class="ai-feature" onclick="aiHelp()">
                        ‚ùì<br>Yardƒ±m
                    </div>
                    <div class="ai-feature" onclick="aiEmergency()">
                        üöë<br>Acil Durum
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <button class="btn" onclick="openAIChat()" style="width: 100%; background: rgba(255,255,255,0.2);">
                        AI ile Sohbet Et
                    </button>
                </div>
            </div>

            <!-- System Info -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">‚öôÔ∏è</span>
                    <span class="card-title">Sistem Bilgisi</span>
                </div>
                <div style="space-y: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>CPU Kullanƒ±mƒ±:</span>
                        <span id="cpu-usage">23%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>RAM Kullanƒ±mƒ±:</span>
                        <span id="ram-usage">1.2GB / 4GB</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Disk Kullanƒ±mƒ±:</span>
                        <span id="disk-usage">8.5GB / 64GB</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Sƒ±caklƒ±k:</span>
                        <span id="temperature">42¬∞C</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Nem:</span>
                        <span id="humidity">65%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <span>√áalƒ±≈üma S√ºresi:</span>
                        <span id="uptime">2 g√ºn 14 saat</span>
                    </div>
                    <button class="btn btn-secondary" onclick="openSettings()" style="width: 100%;">
                        Ayarlar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Mesaj G√∂nder</h3>
                <span class="close" onclick="closeModal('messageModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>Alƒ±cƒ±:</label>
                <select id="message-recipient">
                    <option value="">Herkese (Yayƒ±n)</option>
                    <option value="dolphin">dolphin</option>
                    <option value="eagle">eagle</option>
                    <option value="mountain">mountain</option>
                </select>
            </div>
            <div class="form-group">
                <label>Mesaj T√ºr√º:</label>
                <select id="message-type">
                    <option value="text">Normal Mesaj</option>
                    <option value="emergency">Acil Durum</option>
                    <option value="status">Durum Bildirimi</option>
                </select>
            </div>
            <div class="form-group">
                <label>Mesaj:</label>
                <textarea id="message-content" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n..."></textarea>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" onclick="closeModal('messageModal')">ƒ∞ptal</button>
                <button class="btn" onclick="sendMessage()">G√∂nder</button>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div id="aiModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ü§ñ AI Asistan</h3>
                <span class="close" onclick="closeModal('aiModal')">&times;</span>
            </div>
            <div id="ai-chat" style="height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 15px; margin-bottom: 15px; border-radius: 8px;">
                <div style="color: #666; text-align: center; margin-top: 100px;">
                    AI asistanƒ±nƒ±z ile sohbet etmeye ba≈ülayƒ±n...
                </div>
            </div>
            <div class="form-group">
                <input type="text" id="ai-input" placeholder="Sorunuzu yazƒ±n..." onkeypress="if(event.key==='Enter') sendAIMessage()">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" onclick="closeModal('aiModal')">Kapat</button>
                <button class="btn" onclick="sendAIMessage()">G√∂nder</button>
            </div>
        </div>
    </div>

    <script>
        // Real-time data updates
        function updateDashboard() {
            // Update system stats
            fetch('/api/system/status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('online-devices').textContent = data.status.online_devices;
                        document.getElementById('messages-today').textContent = data.status.messages_today;
                    }
                })
                .catch(error => console.log('Offline mode'));

            // Update device list
            fetch('/api/devices/online')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateDeviceList(data.devices);
                    }
                })
                .catch(error => console.log('Offline mode'));

            // Update messages
            fetch('/api/messages/' + getCurrentDeviceId())
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateMessageList(data.messages);
                    }
                })
                .catch(error => console.log('Offline mode'));
        }

        function updateDeviceList(devices) {
            const deviceList = document.getElementById('device-list');
            deviceList.innerHTML = '';
            
            devices.forEach(device => {
                if (device.name !== getCurrentDeviceName()) {
                    const deviceItem = document.createElement('div');
                    deviceItem.className = 'device-item';
                    deviceItem.innerHTML = `
                        <div class="device-info">
                            <div class="device-status ${device.is_online ? '' : 'offline'}"></div>
                            <div>
                                <strong>${device.name}</strong><br>
                                <small>${device.device_type} ‚Ä¢ ${device.is_online ? '√áevrimi√ßi' : '√áevrimdƒ±≈üƒ±'}</small>
                            </div>
                        </div>
                        <div>${device.signal_strength ? device.signal_strength + ' dBm' : 'N/A'}</div>
                    `;
                    deviceList.appendChild(deviceItem);
                }
            });
        }

        function updateMessageList(messages) {
            const messageList = document.getElementById('message-list');
            messageList.innerHTML = '';
            
            messages.slice(0, 5).forEach(message => {
                const messageItem = document.createElement('div');
                messageItem.className = `message-item ${message.message_type === 'sos' || message.message_type === 'emergency' ? 'emergency' : ''}`;
                
                const timeAgo = getTimeAgo(new Date(message.created_at));
                messageItem.innerHTML = `
                    <div class="message-header">
                        <strong>${message.sender_id}</strong>
                        <span>${timeAgo}</span>
                    </div>
                    <div class="message-content">
                        ${message.message_type === 'sos' ? 'üö® ' : ''}${message.content}
                    </div>
                `;
                messageList.appendChild(messageItem);
            });
        }

        function sendSOS() {
            if (confirm('SOS sinyali g√∂nderilsin mi? Bu acil durum mesajƒ± t√ºm yakƒ±ndaki cihazlara iletilecektir.')) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const sosData = {
                        device_id: getCurrentDeviceId(),
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        description: 'Acil yardƒ±m gerekiyor!'
                    };
                    
                    fetch('/api/emergency/sos', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(sosData)
                    }).then(response => {
                        if (response.ok) {
                            alert('SOS sinyali g√∂nderildi!');
                            updateDashboard();
                        } else {
                            alert('SOS g√∂nderilirken hata olu≈ütu.');
                        }
                    }).catch(error => {
                        // Offline mode - store locally
                        localStorage.setItem('pending_sos', JSON.stringify(sosData));
                        alert('SOS kaydedildi. Baƒülantƒ± kurulduƒüunda g√∂nderilecek.');
                    });
                }, function(error) {
                    alert('Konum alƒ±namadƒ±. SOS manuel olarak g√∂nderilsin mi?');
                });
            }
        }

        function openMessageModal() {
            document.getElementById('messageModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function sendMessage() {
            const recipient = document.getElementById('message-recipient').value;
            const type = document.getElementById('message-type').value;
            const content = document.getElementById('message-content').value;
            
            if (!content.trim()) {
                alert('L√ºtfen bir mesaj yazƒ±n.');
                return;
            }
            
            const messageData = {
                sender_id: getCurrentDeviceId(),
                recipient_id: recipient || null,
                message_type: type,
                content: content,
                priority: type === 'emergency' ? 4 : 1
            };
            
            fetch('/api/message/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(messageData)
            }).then(response => {
                if (response.ok) {
                    alert('Mesaj g√∂nderildi!');
                    closeModal('messageModal');
                    document.getElementById('message-content').value = '';
                    updateDashboard();
                } else {
                    alert('Mesaj g√∂nderilirken hata olu≈ütu.');
                }
            }).catch(error => {
                // Offline mode
                alert('√áevrimdƒ±≈üƒ± mod. Mesaj baƒülantƒ± kurulduƒüunda g√∂nderilecek.');
            });
        }

        function openAIChat() {
            document.getElementById('aiModal').style.display = 'block';
        }

        function sendAIMessage() {
            const input = document.getElementById('ai-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            const chatDiv = document.getElementById('ai-chat');
            
            // Add user message
            chatDiv.innerHTML += `
                <div style="text-align: right; margin-bottom: 10px;">
                    <div style="background: #667eea; color: white; padding: 10px; border-radius: 10px; display: inline-block; max-width: 80%;">
                        ${message}
                    </div>
                </div>
            `;
            
            // Add AI response (simulated for offline mode)
            setTimeout(() => {
                chatDiv.innerHTML += `
                    <div style="text-align: left; margin-bottom: 10px;">
                        <div style="background: #f1f3f4; padding: 10px; border-radius: 10px; display: inline-block; max-width: 80%;">
                            ü§ñ √úzg√ºn√ºm, ≈üu anda √ßevrimdƒ±≈üƒ± modda √ßalƒ±≈üƒ±yorum. ƒ∞nternet baƒülantƒ±sƒ± olduƒüunda tam AI √∂zelliklerine eri≈üebilirsiniz.
                        </div>
                    </div>
                `;
                chatDiv.scrollTop = chatDiv.scrollHeight;
            }, 1000);
            
            input.value = '';
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }

        function aiTranslate() {
            alert('√áeviri √∂zelliƒüi i√ßin internet baƒülantƒ±sƒ± gerekiyor.');
        }

        function aiAnalyze() {
            alert('Analiz √∂zelliƒüi i√ßin internet baƒülantƒ±sƒ± gerekiyor.');
        }

        function aiHelp() {
            openAIChat();
        }

        function aiEmergency() {
            alert('Acil durum AI desteƒüi i√ßin internet baƒülantƒ±sƒ± gerekiyor.');
        }

        function openSettings() {
            window.location.href = '/settings';
        }

        function getCurrentDeviceId() {
            return localStorage.getItem('device_id') || 'unknown';
        }

        function getCurrentDeviceName() {
            return localStorage.getItem('device_name') || 'octopus';
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffMins < 1) return 'Az √∂nce';
            if (diffMins < 60) return diffMins + ' dakika √∂nce';
            if (diffHours < 24) return diffHours + ' saat √∂nce';
            return diffDays + ' g√ºn √∂nce';
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            setInterval(updateDashboard, 30000); // Update every 30 seconds
            
            // Set device name in header
            document.getElementById('device-name').textContent = getCurrentDeviceName();
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>

